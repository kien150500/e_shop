{% extends 'store/base.html' %}

{% block title %}Sản phẩm - E-Shop{% endblock %}

{% block content %}

<div style="display:flex; gap:20px;">

    <!-- Sidebar category -->
    <div style="width:200px;">
        <h3>Danh mục</h3>
        <ul>
            <li><a href="{% url 'product_list' %}">Tất cả</a></li>
            {% for c in categories %}
                <li>
                    <a href="{% url 'product_list_by_category' c.slug %}">
                        {{ c.name }}
                    </a>
                </li>
            {% endfor %}
        </ul>
    </div>

    <form method="get" style="margin-bottom:20px; display:flex; gap:10px; align-items:end;">
        <div>
            <label>Giá từ</label><br>
            <input type="number" name="min_price" value="{{ min_price }}">
        </div>

        <div>
            <label>Đến</label><br>
            <input type="number" name="max_price" value="{{ max_price }}">
        </div>

        <div>
            <label>Sắp xếp</label><br>
            <select name="sort">
                <option value="">Mặc định</option>
                <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Giá tăng dần</option>
                <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Giá giảm dần</option>
                <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Mới nhất</option>
            </select>
        </div>

        <button type="submit">Lọc</button>
    </form>


    <div style="flex:1;">
        <!-- Search -->
        <form method="get">
            <input type="text" name="q" placeholder="Tìm sản phẩm..."
                   value="{{ query|default:'' }}">
            <button type="submit">Tìm</button>
        </form>

        <h2>Sản phẩm</h2>

        {% if products %}
            <div class="product-list">
                {% for product in products %}
                    <div class="product-card">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        {% endif %}
                        <h3><a href="{% url 'product_detail' product.slug %}">{{ product.name }}</a></h3>
                        <p class="price">${{ product.price }}</p>
                    </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            <div style="margin-top:20px;">
                {% if products.has_previous %}
                    <a href="?page={{ products.previous_page_number }}
                    {% if query %}&q={{ query }}{% endif %}
                    {% if min_price %}&min_price={{ min_price }}{% endif %}
                    {% if max_price %}&max_price={{ max_price }}{% endif %}
                    {% if sort %}&sort={{ sort }}{% endif %}
                    ">Previous</a>
                {% endif %}

                <span>Trang {{ products.number }} / {{ products.paginator.num_pages }}</span>

                {% if products.has_next %}
                    <a href="?page={{ products.next_page_number }}
                    {% if query %}&q={{ query }}{% endif %}
                    {% if min_price %}&min_price={{ min_price }}{% endif %}
                    {% if max_price %}&max_price={{ max_price }}{% endif %}
                    {% if sort %}&sort={{ sort }}{% endif %}
                    ">Next</a>
                {% endif %}
            </div>

        {% else %}
            <p>Không có sản phẩm nào.</p>
        {% endif %}
    </div>

</div>

{% endblock %}
